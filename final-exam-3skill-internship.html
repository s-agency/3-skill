<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Online Exam Portal</title>
    <link rel="stylesheet" href="style.css">
     <link rel="icon" type="image/png" href="download.png">
</head>
<body>
    <div class="warning-indicator" id="warningIndicator">
        Warning: Suspicious Activity Detected <span class="warning-count" id="warningCount">1</span>
    </div>

    <div class="container">
        <!-- Registration Screen -->
        <div class="registration-screen active">
            <div class="card">
                <h1>üìù Secure Online Exam Portal</h1>
                <form id="registrationForm">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="fullName" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label>Email Address *</label>
                        <input type="email" id="email" required placeholder="Enter your email">
                    </div>
                    <button type="submit" class="btn">Start Exam üöÄ</button>
                </form>
            </div>
        </div>

        <!-- Exam Screen -->
        <div class="exam-screen">
            <div class="exam-header">
                <div class="camera-indicator">
                    <div class="camera-dot"></div>
                    <span>Camera Active</span>
                </div>
                <div class="timer" id="timer">60:00</div>
                <div style="width: 100%;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                    <div style="text-align: center; margin-top: 5px; font-size: 14px;">
                        Question <span id="currentQ">1</span> of <span id="totalQ">50</span>
                    </div>
                </div>
            </div>

            <div class="question-card">
                <div class="question-text" id="questionText"></div>
                <div id="optionsContainer"></div>
            </div>
        </div>

        <!-- Success Screen -->
        <div class="success-screen">
            <div class="card" style="text-align: center;">
                <div class="success-icon">‚úÖ</div>
                <h1>Exam Submitted Successfully!</h1>
                <p style="font-size: 18px; margin-top: 20px; opacity: 0.8;">
                    Your answers have been recorded. You will receive your results via email.
                </p>
                <p style="margin-top: 30px; font-size: 16px;">
                    Thank you for participating!
                </p>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;">‚ö†Ô∏è Important Instructions</h2>
            <p style="line-height: 1.8; opacity: 0.9;">
                ‚Ä¢ Exam duration: 30 minutes<br>
                ‚Ä¢ 50 multiple choice questions<br>
                ‚Ä¢ Camera will be monitored<br>
                ‚Ä¢ Do NOT switch tabs or minimize<br>
                ‚Ä¢ Exam will auto-submit if you do<br>
                ‚Ä¢ Copying text is prohibited<br>
                ‚Ä¢ Face must remain visible to camera<br>
                ‚Ä¢ AI proctoring will monitor for suspicious activity<br>
                ‚Ä¢ 3 warnings will result in auto-submission
            </p>
            <div class="modal-buttons">
                <button class="modal-btn btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="modal-btn btn-confirm" onclick="startExam()">I Understand, Start</button>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal" id="loadingModal">
        <div class="modal-content">
            <div class="loader"></div>
            <p style="margin-top: 20px;" id="loadingMessage">Loading...</p>
        </div>
    </div>

    <!-- Already Submitted Modal -->
    <div class="modal" id="alreadySubmittedModal">
        <div class="modal-content">
            <div class="success-icon">‚ö†Ô∏è</div>
            <h2>Exam Already Submitted</h2>
            <p style="line-height: 1.8; margin-top: 20px; opacity: 0.9;">
                You have already submitted your exam. You cannot attempt again.
            </p>
            <div class="modal-buttons">
                <button class="modal-btn btn-confirm" onclick="closeAlreadySubmittedModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Camera Box -->
    <div class="camera-container" style="display: none;">
        <div class="camera-label">AI Proctoring Active</div>
        <video id="cameraBox" autoplay muted></video>
        <div class="face-overlay" id="faceOverlay"></div>
        <div class="detection-status" id="detectionStatus">Face Detected</div>
    </div>

    <video id="camera" autoplay muted></video>

    <script src="script.js"></script>
</body>
</html>
<style>
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #000000;
    min-height: 100vh;
    color: #ffffff;
    overflow-x: hidden;
    position: relative;
}

.container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
}

.registration-screen, .exam-screen, .success-screen {
    display: none;
    animation: fadeIn 0.5s ease-in;
}

.registration-screen.active, .exam-screen.active, .success-screen.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.card {
    background: #111111;
    border-radius: 15px;
    padding: 40px;
    box-shadow: 0 8px 32px rgba(0, 255, 0, 0.1);
    border: 1px solid #333333;
}

h1 {
    text-align: center;
    margin-bottom: 30px;
    font-size: 2.5em;
    color: #00ff00;
    text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
}

.form-group {
    margin-bottom: 25px;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #ffffff;
}

input, select {
    width: 100%;
    padding: 15px;
    border: 2px solid #333333;
    border-radius: 10px;
    background: #000000;
    color: #ffffff;
    font-size: 16px;
    transition: all 0.3s ease;
}

input:focus, select:focus {
    outline: none;
    border-color: #00ff00;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
}

select option {
    background: #000000;
    color: #ffffff;
}

.btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #00ff00;
    color: #000000;
    box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 255, 0, 0.5);
}

.btn:active {
    transform: translateY(0);
}

.exam-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background: #111111;
    border-radius: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
    border: 1px solid #333333;
    position: relative;
}

.timer {
    font-size: 24px;
    font-weight: bold;
    color: #00ff00;
    text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #333333;
    border-radius: 10px;
    overflow: hidden;
    margin-top: 10px;
}

.progress-fill {
    height: 100%;
    background: #00ff00;
    transition: width 0.3s ease;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
}

.question-card {
    background: #111111;
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 20px;
    border: 1px solid #333333;
}

.question-text {
    font-size: 20px;
    margin-bottom: 25px;
    line-height: 1.6;
}

.option {
    background: #000000;
    padding: 15px 20px;
    border-radius: 10px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid #333333;
}

.option:hover {
    background: #111111;
    border-color: #00ff00;
}

.option.selected {
    background: #111111;
    border-color: #00ff00;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: #111111;
    padding: 40px;
    border-radius: 15px;
    max-width: 500px;
    text-align: center;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
    border: 1px solid #333333;
}

.modal-buttons {
    display: flex;
    gap: 15px;
    margin-top: 25px;
}

.modal-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-confirm {
    background: #00ff00;
    color: #000000;
}

.btn-cancel {
    background: #333333;
    color: #ffffff;
}

.loader {
    border: 4px solid #333333;
    border-top: 4px solid #00ff00;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.camera-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #00ff00;
}

.camera-dot {
    width: 12px;
    height: 12px;
    background: #00ff00;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.success-icon {
    font-size: 80px;
    color: #00ff00;
    margin-bottom: 20px;
}

/* Camera box styling - Top Right */
.camera-container {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 180px;
    height: 120px;
    background: #000000;
    border: 2px solid #00ff00;
    border-radius: 10px;
    overflow: hidden;
    z-index: 100;
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
}

.camera-container video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.camera-label {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    color: #00ff00;
    padding: 5px;
    text-align: center;
    font-size: 12px;
}

/* Warning indicator */
.warning-indicator {
    position: fixed;
    top: 20px;
    left: 20px;
    background: #ff0000;
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    font-weight: bold;
    z-index: 1000;
    display: none;
    box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
}

.warning-count {
    background: white;
    color: black;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: 5px;
}

/* Face detection overlay */
.face-overlay {
    position: absolute;
    border: 2px solid #00ff00;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
    display: none;
}

@media (max-width: 768px) {
    .container {
        padding: 10px;
    }

    .card {
        padding: 20px;
    }

    h1 {
        font-size: 1.8em;
    }

    .question-text {
        font-size: 18px;
    }

    .exam-header {
        font-size: 14px;
    }

    .timer {
        font-size: 20px;
    }

    .camera-container {
        width: 150px;
        height: 100px;
        top: 10px;
        right: 10px;
    }
}

/* Hide the original video element */
#camera {
    display: none;
}

.detection-status {
    position: absolute;
    bottom: 5px;
    left: 5px;
    font-size: 10px;
    color: #00ff00;
    background: rgba(0, 0, 0, 0.7);
    padding: 2px 5px;
    border-radius: 3px;
}
</style>
<script>
    // ========== CONFIGURATION ==========
const EXAM_DURATION = 30 * 60; // 20 minutes in seconds
// ‚ö†Ô∏è REPLACE THIS WITH YOUR ACTUAL WEB APP URL
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwT9b0-0c1dUBAynACELGGrhe9OHtvijPa1avPPBExrhFWSVnchdqT1yft1UrFBcZYx/exec';

// ========== MOBILE DETECTION ==========
function isMobileDevice() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
}

function checkDeviceCompatibility() {
    if (isMobileDevice()) {
        document.body.innerHTML = `
            <div class="container">
                <div class="card" style="text-align: center;">
                    <div style="font-size: 80px; color: #ff4444; margin-bottom: 20px;">üì±‚ùå</div>
                    <h1>Mobile Device Not Supported</h1>
                    <p style="font-size: 18px; margin-top: 20px; opacity: 0.8;">
                        This exam can only be taken on a desktop or laptop computer.
                    </p>
                    <p style="margin-top: 15px; font-size: 16px; opacity: 0.7;">
                        Please use a computer with a keyboard, mouse, and webcam to continue.
                    </p>
                    <div style="margin-top: 30px; padding: 20px; background: #1a1a1a; border-radius: 10px;">
                        <h3>üìã System Requirements:</h3>
                        <ul style="text-align: left; margin-top: 15px; line-height: 1.8;">
                            <li>üíª Desktop or Laptop Computer</li>
                            <li>üñ•Ô∏è Minimum Screen Size: 1024x768 pixels</li>
                            <li>üì∑ Webcam for proctoring</li>
                            <li>‚å®Ô∏è Keyboard and Mouse</li>
                            <li>üåê Stable Internet Connection</li>
                        </ul>
                    </div>
                </div>
            </div>
        `;
        return false;
    }
    return true;
}

 // ========== QUESTION BANK ==========
       const questionBank = {
            "Fullstack Development":[
  {q: "Which of the following correctly describes REST?", options: ["A stateful architecture", "A stateless web service style", "A session-based model", "A SOAP-based architecture"], correct: 1},
  {q: "Which command initializes a Node.js project?", options: ["npm create", "npm init", "node start", "npx install"], correct: 1},
  {q: "In React, the key prop in lists is used for:", options: ["Styling the list", "Identifying elements for efficient rendering", "Sorting data", "Triggering re-render manually"], correct: 1},
  {q: "Which HTTP method is idempotent?", options: ["POST", "PUT", "PATCH", "CONNECT"], correct: 1},
  {q: "In Express.js, app.use() is used to:", options: ["Create a database connection", "Register middleware", "Define a route", "Handle errors only"], correct: 1},
  {q: "Which database is NoSQL?", options: ["PostgreSQL", "MySQL", "MongoDB", "MariaDB"], correct: 2},
  {q: "Which of the following starts a Flask app?", options: ["flask start", "flask run", "python flask", "flask serve"], correct: 1},
  {q: "CORS stands for:", options: ["Client-Origin Request Source", "Cross-Origin Resource Sharing", "Centralized Object Response Server", "Client-Origin Routing System"], correct: 1},
  {q: "Which React hook is used for side effects?", options: ["useEffect()", "useState()", "useCallback()", "useRef()"], correct: 0},
  {q: "In SQL, the HAVING clause is used to:", options: ["Filter individual rows", "Filter groups", "Sort results", "Join tables"], correct: 1},
  {q: "What is the role of the event loop in Node.js?", options: ["Handles async callbacks in a single thread", "Runs multiple threads", "Executes synchronous code", "Schedules cron jobs"], correct: 0},
  {q: "In microservices, a drawback of synchronous communication is:", options: ["Tight coupling", "Low latency", "Loose coupling", "Easier scaling"], correct: 0},
  {q: "Which of these is NOT part of the MERN stack?", options: ["MongoDB", "Express", "React", "Django"], correct: 3},
  {q: "GraphQL resolvers are used to:", options: ["Define API endpoints", "Fetch and return data for queries", "Create tables", "Handle authentication"], correct: 1},
  {q: "Which pattern does Redux follow?", options: ["Observer", "Flux", "Singleton", "MVC"], correct: 1},
  {q: "Default concurrency model in Node.js is:", options: ["Multi-threaded", "Single-threaded non-blocking", "Multi-core synchronous", "Event-based blocking"], correct: 1},
  {q: "In Docker, a bind mount:", options: ["Copies files during build", "Mounts host directory to container", "Creates container snapshot", "Deletes temporary volumes"], correct: 1},
  {q: "Middleware in Express.js is used to:", options: ["Process requests before reaching routes", "Configure the database", "Render HTML", "Encrypt data"], correct: 0},
  {q: "Which HTTP code means 'Unprocessable Entity'?", options: ["400", "403", "422", "409"], correct: 2},
  {q: "JWT (JSON Web Token) is:", options: ["A session-based token", "A stateless token format", "A cookie manager", "A REST API method"], correct: 1},
  {q: "React Context API helps in:", options: ["Avoiding prop drilling", "Styling components", "Optimizing loops", "Handling side effects"], correct: 0},
  {q: "Database sharding means:", options: ["Caching queries", "Splitting data horizontally", "Backing up databases", "Encrypting records"], correct: 1},
  {q: "MongoDB high availability is achieved using:", options: ["Indexes", "Replica sets", "Views", "Aggregations"], correct: 1},
  {q: "Node.js module for file I/O is:", options: ["path", "fs", "os", "net"], correct: 1},
  {q: "Webpack is used to:", options: ["Compile backend code", "Bundle frontend assets", "Run servers", "Test code"], correct: 1},
  {q: "Serverless architecture means:", options: ["No servers at all", "Cloud provider runs code on demand", "Manual deployment", "Using containers"], correct: 1},
  {q: "React code splitting helps with:", options: ["UI animation", "Lazy loading components", "CSS styling", "Unit testing"], correct: 1},
  {q: "In Node.js, clustering allows:", options: ["One process only", "Multiple instances to use multiple cores", "Async tasks", "Error handling"], correct: 1},
  {q: "CAP theorem means:", options: ["Consistency, Accuracy, Performance", "Consistency, Availability, Partition tolerance", "Cache, API, Persistence", "Communication, Access, Parallelism"], correct: 1},
  {q: "NGINX acts as:", options: ["Reverse proxy and load balancer", "Frontend compiler", "Testing framework", "Database manager"], correct: 0},
  {q: "Docker Compose is used to:", options: ["Run single containers", "Define multi-container apps", "Build Docker images", "Update registries"], correct: 1},
  {q: "The async/await syntax helps:", options: ["Handle asynchronous code sequentially", "Create threads", "Stop execution", "Parse JSON"], correct: 0},
  {q: "CSRF protection prevents:", options: ["SQL injection", "Cross-site request forgery", "DDoS attacks", "Brute-force login"], correct: 1},
  {q: "Load balancing vs clustering difference:", options: ["Same purpose", "Load balancing distributes traffic; clustering runs multiple servers", "Clustering distributes traffic", "Both are backend frameworks"], correct: 1},
  {q: "GraphQL queries vs mutations:", options: ["Both modify data", "Queries fetch, mutations modify data", "Queries modify, mutations fetch", "Both delete data"], correct: 1},
  {q: "Redis is mainly used for:", options: ["Storing images", "Caching and session storage", "File management", "Logging"], correct: 1},
  {q: "WebSocket protocol uses:", options: ["http://", "ws:// or wss://", "ftp://", "ssh://"], correct: 1},
  {q: "OAuth vs JWT:", options: ["OAuth is a token format", "JWT is an auth protocol", "OAuth is a protocol; JWT is a token format", "Both are the same"], correct: 2},
  {q: "CI/CD in DevOps stands for:", options: ["Continuous Integration / Continuous Deployment", "Code Integration / Code Delivery", "Centralized Input / Centralized Data", "Continuous Infrastructure / Container Deployment"], correct: 0},
  {q: "In React, Suspense is used for:", options: ["Lazy loading async components", "Error handling", "Styling", "Routing"], correct: 0},
  {q: "TypeScript adds:", options: ["Dynamic typing", "Static typing", "Async utilities", "Compilation speed"], correct: 1},
  {q: "Horizontal scaling means:", options: ["Adding more CPUs", "Adding more machines", "Upgrading RAM only", "Rewriting code"], correct: 1},
  {q: "MVC architecture separates:", options: ["Database from logic only", "Model, View, Controller", "Server, Client, Router", "API and Database"], correct: 1},
  {q: "Which HTTP code means 'Conflict'?", options: ["400", "404", "409", "410"], correct: 2},
  {q: "Purpose of Babel in React is to:", options: ["Compile JSX to JavaScript", "Test components", "Manage state", "Handle routing"], correct: 0},
  {q: "Redux uses a single:", options: ["Local storage", "Store for all state", "Component memory", "Hook"], correct: 1},
  {q: "React Fiber is:", options: ["Rendering engine for React", "Testing library", "State manager", "Database"], correct: 0},
  {q: "A reverse proxy:", options: ["Routes client requests to backend servers", "Connects directly to a database", "Encrypts client data", "Hosts front-end only"], correct: 0},
  {q: "The useMemo hook in React is used to:", options: ["Cache computed values", "Manage state", "Trigger effects", "Handle forms"], correct: 0},
  {q: "Webpack‚Äôs tree shaking removes:", options: ["Unused CSS", "Unused JS code", "Redundant HTML", "Images"], correct: 1}
],


            "AIML":[
  {q: "Which of the following is NOT a supervised learning algorithm?", options: ["Linear Regression", "Decision Tree", "K-Means Clustering", "Random Forest"], correct: 2},
  {q: "Gradient Descent is used to:", options: ["Increase the cost function", "Minimize the loss function", "Normalize input data", "Split datasets"], correct: 1},
  {q: "Activation function in neural networks introduces:", options: ["Linearity", "Non-linearity", "Regularization", "Normalization"], correct: 1},
  {q: "Which of the following is an example of reinforcement learning?", options: ["Predicting house prices", "Self-driving car learning by rewards", "Image classification", "Spam filtering"], correct: 1},
  {q: "What does 'epoch' mean in deep learning?", options: ["One complete pass through training data", "A single batch of training", "Number of layers", "A neural activation"], correct: 0},
  {q: "In SVM, the hyperplane is:", options: ["A decision boundary separating classes", "A data normalization function", "A kernel function", "A type of loss"], correct: 0},
  {q: "Overfitting occurs when:", options: ["Model fits training data too well and fails to generalize", "Model under-learns the data", "Model performs well on both sets", "Model lacks parameters"], correct: 0},
  {q: "Dropout in neural networks is used for:", options: ["Increasing bias", "Preventing overfitting", "Increasing training time", "Reducing batch size"], correct: 1},
  {q: "Which of the following is true for ReLU activation?", options: ["Outputs only negative values", "Is non-linear and fast to compute", "Has vanishing gradient always", "Is linear for all inputs"], correct: 1},
  {q: "Confusion matrix is used to evaluate:", options: ["Clustering models", "Classification models", "Regression models", "Dimensionality reduction"], correct: 1},
  {q: "The vanishing gradient problem mainly affects:", options: ["CNNs", "RNNs with deep time steps", "Decision trees", "KNN"], correct: 1},
  {q: "Which optimizer adapts learning rates using first and second moment estimates?", options: ["SGD", "Adam", "Adagrad", "RMSProp"], correct: 1},
  {q: "What does the Jacobian matrix represent in backpropagation?", options: ["Weight initialization", "Derivative of output w.r.t inputs", "Bias regularization", "Covariance of activations"], correct: 1},
  {q: "L1 regularization encourages:", options: ["Sparse weights", "Small weights but non-zero", "Zero mean", "Large gradients"], correct: 0},
  {q: "The softmax function is typically used in:", options: ["Hidden layers", "Output layer for multi-class classification", "Recurrent cells", "Dropout layers"], correct: 1},
  {q: "The curse of dimensionality refers to:", options: ["Model overfitting in low dimensions", "Performance degradation as feature space grows", "Training time reduction", "Fewer parameters in high dimension"], correct: 1},
  {q: "PCA reduces dimensionality by:", options: ["Removing correlated features", "Projecting data onto principal components", "Increasing variance", "Removing noise only"], correct: 1},
  {q: "Gradient clipping helps in:", options: ["Preventing exploding gradients", "Avoiding vanishing gradients", "Regularizing weights", "Improving accuracy"], correct: 0},
  {q: "The loss function used in logistic regression is:", options: ["Mean Squared Error", "Cross Entropy", "Hinge Loss", "KL Divergence"], correct: 1},
  {q: "KL Divergence measures:", options: ["Distance between two probability distributions", "Correlation of variables", "Weight decay", "Mean difference"], correct: 0},
  {q: "Batch Normalization normalizes:", options: ["Layer inputs per batch", "Gradients per epoch", "Weights per layer", "Outputs per dataset"], correct: 0},
  {q: "What is the main advantage of the Transformer architecture?", options: ["Sequential processing", "Parallelization via attention", "Reduced model size", "No need for embeddings"], correct: 1},
  {q: "In reinforcement learning, the Bellman equation defines:", options: ["Loss function", "Relationship between state and value", "Policy gradient", "Reward normalization"], correct: 1},
  {q: "The attention mechanism improves:", options: ["Memory of long-term dependencies", "Training speed", "Weight initialization", "Gradient flow only"], correct: 0},
  {q: "The output of a sigmoid neuron lies between:", options: ["0 and 1", "‚àí1 and 1", "0 and ‚àû", "‚àí‚àû and +‚àû"], correct: 0},
  {q: "LSTM cells solve:", options: ["Vanishing gradient in RNNs", "Dropout problems", "Weight initialization", "Feature extraction"], correct: 0},
  {q: "Xavier initialization is used for:", options: ["Keeping variance of activations constant", "Increasing learning rate", "Reducing batch size", "Preventing bias updates"], correct: 0},
  {q: "A convolution kernel of size 3√ó3 with stride 2 reduces:", options: ["Output dimension", "Batch size", "Channel depth", "Activation count"], correct: 0},
  {q: "Autoencoders are trained to:", options: ["Predict class labels", "Reconstruct input data", "Minimize gradient", "Classify objects"], correct: 1},
  {q: "GANs consist of:", options: ["Two discriminators", "A generator and discriminator", "Two encoders", "Two decoders"], correct: 1},
  {q: "The generator in a GAN tries to:", options: ["Classify images", "Fool the discriminator", "Minimize accuracy", "Increase bias"], correct: 1},
  {q: "In k-NN, increasing k too much causes:", options: ["Overfitting", "Underfitting", "Faster learning", "No change"], correct: 1},
  {q: "ROC curve plots:", options: ["Precision vs Recall", "True Positive Rate vs False Positive Rate", "Accuracy vs Recall", "F1 vs Precision"], correct: 1},
  {q: "Ensemble methods reduce:", options: ["Variance and bias", "Only variance", "Only bias", "Overhead"], correct: 0},
  {q: "Bagging works by:", options: ["Using different subsets of data", "Sequential model training", "Boosting weak learners", "Reducing learning rate"], correct: 0},
  {q: "AdaBoost assigns:", options: ["Equal weights to all samples", "Higher weights to misclassified samples", "Lower weights to important samples", "Random weights"], correct: 1},
  {q: "The 'Q' in Q-learning stands for:", options: ["Quantity", "Quality", "Query", "Quotient"], correct: 1},
  {q: "Policy Gradient methods optimize:", options: ["Expected reward directly", "Loss indirectly", "Value functions", "Bellman error"], correct: 0},
  {q: "Word2Vec uses which training objective?", options: ["Cross Entropy", "Skip-gram / CBOW prediction", "Reconstruction", "Attention loss"], correct: 1},
  {q: "BERT uses:", options: ["Bidirectional transformers", "Unidirectional RNNs", "CNN layers", "Only decoder blocks"], correct: 0},
  {q: "In reinforcement learning, exploration vs exploitation trade-off occurs because:", options: ["Model cannot access all states", "Agent must balance trying new actions vs maximizing reward", "Policy updates are fixed", "Rewards are constant"], correct: 1},
  {q: "A deep neural network with too many parameters tends to:", options: ["Overfit", "Underfit", "Learn faster", "Be more stable"], correct: 0},
  {q: "Variational Autoencoder introduces:", options: ["Probabilistic latent variables", "Deterministic encoding", "Hard clustering", "Fixed weights"], correct: 0},
  {q: "The universal approximation theorem states that:", options: ["A neural network can approximate any function", "Only linear models can generalize", "CNNs are universal classifiers", "Transformers outperform all"], correct: 0},
  {q: "Which metric is best for imbalanced datasets?", options: ["Accuracy", "F1 Score", "Mean Squared Error", "R¬≤"], correct: 1},
  {q: "The ReLU derivative is:", options: ["0 for x < 0, 1 for x ‚â• 0", "1 for all x", "tanh(x)", "sigmoid(x)"], correct: 0},
  {q: "In CNN, pooling layers help:", options: ["Reduce spatial dimensions", "Increase overfitting", "Add channels", "Compute gradients"], correct: 0},
  {q: "The Transformer‚Äôs positional encoding provides:", options: ["Word order information", "Word meaning", "Regularization", "Dropout"], correct: 0},
  {q: "Label smoothing is used to:", options: ["Prevent overconfidence in classification", "Increase precision", "Reduce dropout", "Normalize gradients"], correct: 0},
  {q: "Self-supervised learning is:", options: ["Learning without manual labels", "Reinforcement learning variant", "Unsupervised clustering", "Fully labeled data"], correct: 0}
],


            "Data Analytics": [
  {q: "Which of the following is a measure of central tendency?", options: ["Variance", "Mean", "Range", "Standard deviation"], correct: 1},
  {q: "What is the primary purpose of data cleaning?", options: ["Increase dataset size", "Remove or correct inaccurate data", "Add noise to data", "Normalize variables"], correct: 1},
  {q: "Which type of visualization is best for showing proportions?", options: ["Line chart", "Pie chart", "Scatter plot", "Histogram"], correct: 1},
  {q: "Correlation coefficient measures:", options: ["Strength of nonlinear relationship", "Degree of linear relationship", "Independence of variables", "Probability distribution"], correct: 1},
  {q: "In SQL, which clause is used to group rows that have the same values?", options: ["WHERE", "ORDER BY", "GROUP BY", "HAVING"], correct: 2},
  {q: "Which function in Python‚Äôs pandas library removes missing values?", options: ["dropna()", "fillna()", "remove()", "delete()"], correct: 0},
  {q: "What is the purpose of normalization in data preprocessing?", options: ["Increase variance", "Scale data to a uniform range", "Introduce bias", "Add new features"], correct: 1},
  {q: "Which distribution is symmetrical and bell-shaped?", options: ["Normal distribution", "Exponential distribution", "Uniform distribution", "Poisson distribution"], correct: 0},
  {q: "Which metric measures model accuracy for regression problems?", options: ["RMSE", "Precision", "Recall", "F1-score"], correct: 0},
  {q: "In A/B testing, the 'B' version represents:", options: ["Control group", "Treatment or variant", "Random baseline", "Outlier sample"], correct: 1},
  {q: "What does heteroscedasticity indicate in regression analysis?", options: ["Constant variance of residuals", "Non-constant variance of residuals", "Perfect linearity", "Multicollinearity"], correct: 1},
  {q: "In PCA, principal components are:", options: ["Orthogonal", "Dependent", "Correlated", "Nonlinear"], correct: 0},
  {q: "The p-value in hypothesis testing represents:", options: ["Probability that null hypothesis is true", "Probability of observing data as extreme as sample, assuming null is true", "Type II error", "Sample mean"], correct: 1},
  {q: "In time series, seasonality refers to:", options: ["Long-term trend", "Short-term repetitive pattern", "Random noise", "Structural break"], correct: 1},
  {q: "The 'elbow method' is used to determine:", options: ["Optimal number of clusters in K-means", "Gradient descent step", "Bias-variance tradeoff", "Outlier threshold"], correct: 0},
  {q: "What is multicollinearity?", options: ["Correlation among independent variables", "Correlation between dependent and independent variable", "Nonlinear regression pattern", "Residual autocorrelation"], correct: 0},
  {q: "The ROC-AUC metric is used to measure:", options: ["Regression error", "Classification performance", "Clustering accuracy", "Data distribution"], correct: 1},
  {q: "In SQL, a window function:", options: ["Performs row-by-row operations over partitions", "Deletes duplicate records", "Joins tables", "Changes schema"], correct: 0},
  {q: "Which algorithm is used for dimensionality reduction while preserving distance metrics?", options: ["t-SNE", "Random Forest", "Na√Øve Bayes", "XGBoost"], correct: 0},
  {q: "What does a VIF (Variance Inflation Factor) greater than 10 indicate?", options: ["Strong multicollinearity", "Weak regression model", "Homoscedasticity", "Normal residuals"], correct: 0},
  {q: "In Bayesian inference, the posterior is proportional to:", options: ["Prior √ó Likelihood", "Prior √∑ Likelihood", "Likelihood ‚Äì Prior", "Prior + Likelihood"], correct: 0},
  {q: "Which test is used to check the normality of data?", options: ["Shapiro-Wilk test", "t-test", "Chi-square test", "ANOVA"], correct: 0},
  {q: "Cross-validation is primarily used to:", options: ["Detect overfitting", "Improve training speed", "Reduce dataset size", "Increase model complexity"], correct: 0},
  {q: "What does an R¬≤ value of 0.9 indicate?", options: ["90% variance explained by model", "90% accuracy", "Strong heteroscedasticity", "Poor fit"], correct: 0},
  {q: "What is the key assumption of linear regression?", options: ["Linear relationship between features and target", "Nonlinear mapping", "Categorical features", "Random target"], correct: 0},
  {q: "The covariance matrix in PCA contains:", options: ["Covariances between variables", "Gradients of loss", "Distances between points", "Probabilities"], correct: 0},
  {q: "What is the main goal of feature selection?", options: ["Reduce overfitting and improve interpretability", "Add redundancy", "Increase data imbalance", "Increase training time"], correct: 0},
  {q: "Chi-square test is suitable for:", options: ["Categorical variables", "Continuous variables", "Ordinal variables", "Binary regression"], correct: 0},
  {q: "What does an autocorrelation of 1 imply?", options: ["Perfect positive correlation with lagged value", "No correlation", "Perfect negative correlation", "Randomness"], correct: 0},
  {q: "A confusion matrix is used to derive:", options: ["Precision, Recall, and F1-score", "RMSE", "Adjusted R¬≤", "Mean Absolute Error"], correct: 0},
  {q: "In logistic regression, the logit function maps:", options: ["Probability to log-odds", "Log-odds to probability", "Target to mean", "Loss to weights"], correct: 0},
  {q: "The central limit theorem states:", options: ["Sample means approximate normal distribution for large n", "Population is always normal", "Small samples are normally distributed", "Means are skewed"], correct: 0},
  {q: "Outliers can significantly distort:", options: ["Mean", "Median", "Mode", "Interquartile range"], correct: 0},
  {q: "Which clustering method does not require the number of clusters beforehand?", options: ["DBSCAN", "K-means", "Hierarchical (agglomerative)", "Mean Shift"], correct: 0},
  {q: "The bias-variance trade-off is crucial for:", options: ["Model generalization", "Model speed", "Feature extraction", "Scaling"], correct: 0},
  {q: "The p-value < 0.05 typically indicates:", options: ["Reject null hypothesis", "Fail to reject null", "High correlation", "No significant relationship"], correct: 0},
  {q: "Dimensionality reduction helps to:", options: ["Combat the curse of dimensionality", "Increase feature redundancy", "Reduce interpretability", "Increase overfitting"], correct: 0},
  {q: "Anomaly detection algorithms are useful for:", options: ["Fraud detection", "Clustering", "Regression", "Text generation"], correct: 0},
  {q: "A Pareto chart is a combination of:", options: ["Bar chart and line graph", "Histogram and pie chart", "Scatter and box plot", "Line and area plot"], correct: 0},
  {q: "In regression, residuals represent:", options: ["Errors between predicted and actual values", "Feature correlations", "Weights", "Model bias"], correct: 0},
  {q: "Ridge regression adds penalty on:", options: ["Sum of squared coefficients", "Absolute coefficients", "Variance", "Bias"], correct: 0},
  {q: "What is the role of a confusion matrix diagonal?", options: ["Correctly classified instances", "Misclassifications", "False positives only", "Random predictions"], correct: 0},
  {q: "Missing data that depends on unobserved variables is called:", options: ["MNAR (Missing Not At Random)", "MCAR", "MAR", "Imputed data"], correct: 0},
  {q: "What is the difference between descriptive and predictive analytics?", options: ["Descriptive explains the past; predictive forecasts the future", "Predictive explains past data", "Descriptive uses machine learning", "Predictive uses SQL"], correct: 0},
  {q: "Which test compares means between more than two groups?", options: ["ANOVA", "t-test", "Chi-square", "F-test"], correct: 0},
  {q: "What does a heatmap visualize?", options: ["Correlations or matrix values via colors", "Regression lines", "Time series", "Random points"], correct: 0},
  {q: "A high leverage point in regression is:", options: ["Far from mean in predictor space", "Residual close to zero", "Uncorrelated variable", "Data with small variance"], correct: 0},
  {q: "Mutual information measures:", options: ["Dependence between two variables", "Error variance", "Standard deviation", "Randomness"], correct: 0},
  {q: "Cross-entropy loss is used for:", options: ["Classification problems", "Regression problems", "Clustering", "Outlier detection"], correct: 0},
  {q: "Which of the following best defines data storytelling?", options: ["Communicating insights using visuals and narrative", "Building machine learning models", "Raw data presentation", "SQL query explanation"], correct: 0}
],


            "Frontend Development":[
  {q: "Which of the following is not a valid HTML5 element?", options: ["<section>", "<article>", "<frame>", "<aside>"], correct: 2},
  {q: "The box-sizing: border-box; property in CSS ensures that:", options: ["Padding is excluded from element size", "Margin is excluded from element size", "Border and padding are included in width and height", "Only border is included"], correct: 2},
  {q: "What is the purpose of the key prop in React lists?", options: ["To uniquely identify list items for diffing", "To encrypt list items", "To style each element", "To trigger events"], correct: 0},
  {q: "Which CSS property controls stacking order?", options: ["order", "position", "z-index", "display"], correct: 2},
  {q: "The Virtual DOM in React helps to:", options: ["Directly modify the browser DOM", "Optimize updates by diffing changes before rendering", "Manage routing", "Cache API data"], correct: 1},
  {q: "In React, useEffect() is equivalent to which lifecycle method?", options: ["componentDidMount", "componentWillUnmount", "componentWillReceiveProps", "shouldComponentUpdate"], correct: 0},
  {q: "What is the default display property of a <div>?", options: ["inline", "inline-block", "block", "flex"], correct: 2},
  {q: "What does the alt attribute in an <img> tag specify?", options: ["Image path", "Alternate text if the image cannot load", "Tooltip text", "Caption"], correct: 1},
  {q: "Which HTTP status code means 'Resource Created'?", options: ["200", "201", "400", "404"], correct: 1},
  {q: "Which CSS function supports transparency?", options: ["rgb()", "rgba()", "hex()", "hsl()"], correct: 1},
  {q: "React‚Äôs reconciliation algorithm compares:", options: ["Component props", "Virtual DOM trees and keys", "State and lifecycle methods", "Class and function components"], correct: 1},
  {q: "Webpack 'loaders' are used to:", options: ["Load HTML files", "Convert non-JS assets like CSS or images into JS modules", "Optimize bundles", "Watch for file changes"], correct: 1},
  {q: "The React 'Fiber' architecture improves:", options: ["DOM event handling", "Incremental rendering and task scheduling", "State management", "CSS optimization"], correct: 1},
  {q: "Which function runs animations at optimal frame rate?", options: ["setTimeout()", "requestAnimationFrame()", "setInterval()", "animate()"], correct: 1},
  {q: "Redux implements which design pattern?", options: ["MVC", "Flux", "Singleton", "Observer"], correct: 1},
  {q: "In Next.js, getServerSideProps() executes:", options: ["At build time", "On every request (server-side)", "On the client after hydration", "Only on error pages"], correct: 1},
  {q: "Critical rendering path optimization aims to:", options: ["Delay JS loading", "Reduce render-blocking CSS/JS for faster first paint", "Compress images", "Add transitions"], correct: 1},
  {q: "React‚Äôs Context API mainly avoids:", options: ["Prop drilling", "State duplication", "Re-renders", "Hook conflicts"], correct: 0},
  {q: "What does 'hydration' mean in React SSR?", options: ["Rebuilding HTML", "Binding event handlers to static HTML from server", "Downloading static resources", "Preloading components"], correct: 1},
  {q: "Which feature allows lazy module loading in JS?", options: ["async/await", "Dynamic import()", "Promises", "fetch()"], correct: 1},
  {q: "Shadow DOM is mainly used for:", options: ["Performance optimization", "Encapsulated styles and DOM isolation", "Async rendering", "Virtual DOM updates"], correct: 1},
  {q: "Tree-shaking in Webpack removes:", options: ["Duplicate files", "Unused exports during bundling", "Large images", "Inline scripts"], correct: 1},
  {q: "useCallback() in React is used to:", options: ["Memoize function references between renders", "Cache state values", "Track dependencies", "Manage side effects"], correct: 0},
  {q: "React.memo() helps by:", options: ["Preventing re-render when props are unchanged", "Reducing component size", "Cleaning up memory", "Skipping hook re-execution"], correct: 0},
  {q: "Web Components are composed of:", options: ["Shadow DOM, Custom Elements, and Templates", "Redux store and hooks", "Node.js modules", "HTML preprocessors"], correct: 0},
  {q: "CSS variables use which syntax?", options: ["$var", "--variable", "@var", "%variable"], correct: 1},
  {q: "HTTP/2 multiplexing allows:", options: ["Multiple requests in one TCP connection", "Encrypted data only", "Header caching", "Asynchronous rendering"], correct: 0},
  {q: "display: none vs visibility: hidden ‚Äî difference?", options: ["Both hide but keep space", "None removes from layout; hidden keeps space", "Hidden removes from DOM", "None keeps space"], correct: 1},
  {q: "For debouncing inputs in React, you use:", options: ["useMemo()", "useEffect() with timeout and cleanup", "useRef() only", "Redux"], correct: 1},
  {q: "Relative CSS units like % and em are based on:", options: ["Parent element or font size", "Viewport", "Root element always", "Browser zoom"], correct: 0},
  {q: "Which protocol adds header compression & multiplexing?", options: ["HTTP/2", "HTTP/3", "HTTPS", "TCP"], correct: 0},
  {q: "React Suspense boundaries:", options: ["Pause rendering until data/component is ready", "Handle form validation", "Detect render errors", "Manage routing"], correct: 0},
  {q: "'Critical CSS' refers to:", options: ["CSS used above the fold for fast load", "Unused CSS", "Responsive styles", "Lazy-loaded CSS"], correct: 0},
  {q: "Service Workers enable:", options: ["Background sync & offline caching", "Database management", "DOM updates", "CSS compilation"], correct: 0},
  {q: "Redux middleware like Thunk or Saga handles:", options: ["Asynchronous logic between actions and reducers", "Styling", "Logging", "Component testing"], correct: 0},
  {q: "In Next.js, SSR vs SSG difference?", options: ["SSR = per request; SSG = pre-built at build time", "SSR = faster", "SSG = slower", "No difference"], correct: 0},
  {q: "React Fiber‚Äôs priority scheduling means:", options: ["Renders high-priority updates before others", "Loads all updates at once", "Defers rendering completely", "Removes blocking"], correct: 0},
  {q: "CDNs improve performance by:", options: ["Serving cached assets from closest server", "Compressing data", "Removing images", "Managing scripts"], correct: 0},
  {q: "Intersection Observer API is used for:", options: ["Lazy loading & tracking element visibility", "Form validation", "CSS optimization", "Scroll locking"], correct: 0},
  {q: "Hydration mismatch occurs when:", options: ["Client and server DOM don‚Äôt match", "JS is missing", "Browser fails hydration", "HTML has syntax errors"], correct: 0},
  {q: "Webpack 'plugins' are used to:", options: ["Extend or modify Webpack‚Äôs capabilities", "Only load CSS", "Optimize HTML", "Create maps"], correct: 0},
  {q: "React.lazy() allows:", options: ["Code-splitting and dynamic component loading", "Memoization", "Context sharing", "State updates"], correct: 0},
  {q: "CSS-in-JS downside is:", options: ["Runtime overhead and larger bundle size", "Lack of syntax support", "Limited selectors", "No theming"], correct: 0},
  {q: "React Error Boundaries catch:", options: ["Runtime errors during rendering", "Syntax errors", "Hook errors", "Network errors"], correct: 0},
  {q: "Progressive enhancement relies on:", options: ["Feature detection", "CSS resets", "JS frameworks", "Animations"], correct: 0},
  {q: "React StrictMode is used to:", options: ["Detect unsafe lifecycle and side effects", "Optimize rendering", "Debug CSS", "Catch syntax errors"], correct: 0},
  {q: "Isomorphic JS means:", options: ["Code runs on both client & server", "Hybrid native apps", "CSS-in-JS", "State-based rendering"], correct: 0},
  {q: "Code-splitting helps by:", options: ["Loading only required bundles dynamically", "Removing duplicate code", "Inlining JS", "Caching data"], correct: 0},
  {q: "ETag and Cache-Control headers are used to:", options: ["Reduce redundant requests and cache data", "Track sessions", "Prevent CORS", "Encrypt responses"], correct: 0},
  {q: "Hybrid rendering combines:", options: ["SSR for first paint + Client hydration for interactivity", "SPA and PWA", "CSR and static hosting", "Lazy loading and caching"], correct: 0}
]
        };


// ========== STATE ==========
let userData = {};
let currentQuestions = [];
let currentQuestionIndex = 0;
let answers = [];
let timeRemaining = EXAM_DURATION;
let timerInterval;
let cameraStream;
let warningCount = 0;
let isSubmitting = false;

// Face detection simulation
let faceDetectionInterval;
let facePosition = { x: 60, y: 40, width: 60, height: 70 };
let faceDirection = { x: 1, y: 1 };
let examStartTime;
let fakeDetectionScheduled = false;

// ========== SECURITY ==========
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
    if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || 
        (e.ctrlKey && e.key === 'u') || (e.ctrlKey && e.key === 'c')) {
        e.preventDefault();
        triggerWarning("Developer tools or copy attempt detected");
    }
});
document.addEventListener('copy', e => {
    e.preventDefault();
    triggerWarning("Copy attempt detected");
});
document.addEventListener('cut', e => {
    e.preventDefault();
    triggerWarning("Cut attempt detected");
});

// ========== REGISTRATION ==========
document.getElementById('registrationForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Double-check device compatibility
    if (isMobileDevice()) {
        alert('This exam is not supported on mobile devices. Please use a desktop or laptop computer.');
        return;
    }
    
    const name = document.getElementById('fullName').value.trim();
    const email = document.getElementById('email').value.trim();
    
    if (!name || !email) {
        alert('Please fill all fields');
        return;
    }

    console.log('üü° Starting email verification...');
    console.log('Name:', name);
    console.log('Email:', email);

    // Show loading modal
    document.getElementById('loadingModal').classList.add('active');
    document.getElementById('loadingMessage').textContent = 'Verifying your email...';
    
    try {
        // Use GET request to avoid CORS issues
        const url = `${GOOGLE_SCRIPT_URL}?action=checkEmail&email=${encodeURIComponent(email)}`;
        console.log('üü° Sending GET request to:', url);
        
        const response = await fetch(url);
        console.log('üü¢ Response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('üü¢ Server response:', result);
        
        document.getElementById('loadingModal').classList.remove('active');
        
        if (result.success) {
            if (result.alreadySubmitted) {
                console.log('üî¥ Exam already submitted - blocking attempt');
                document.getElementById('alreadySubmittedModal').classList.add('active');
            } else {
                console.log('üü¢ Email verified. Domain:', result.domain);
                userData = {
                    name: name,
                    email: email,
                    domain: result.domain
                };
                document.getElementById('confirmModal').classList.add('active');
            }
        } else {
            console.log('üî¥ Server returned error:', result.message);
            alert('Error: ' + result.message);
        }
    } catch (error) {
        console.error('üî¥ Network Error:', error);
        document.getElementById('loadingModal').classList.remove('active');
        alert('Network error: ' + error.message);
    }
});

function closeModal() {
    document.getElementById('confirmModal').classList.remove('active');
}

function closeAlreadySubmittedModal() {
    document.getElementById('alreadySubmittedModal').classList.remove('active');
}

async function startExam() {
    closeModal();

    // Final device check before starting exam
    if (isMobileDevice()) {
        alert('Cannot start exam on mobile device. Please use a desktop computer.');
        return;
    }

    // Request camera permission
    try {
        cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
        document.getElementById('camera').srcObject = cameraStream;
        document.getElementById('cameraBox').srcObject = cameraStream;
    } catch (err) {
        alert('Camera permission is required to start the exam!');
        return;
    }

    // Enter fullscreen
    try {
        await document.documentElement.requestFullscreen();
    } catch (err) {
        alert('Please allow fullscreen mode to start the exam');
        return;
    }

    // Setup questions based on domain
    currentQuestions = questionBank[userData.domain].slice();
    shuffleArray(currentQuestions);
    currentQuestions = currentQuestions.slice(0, 50);
    answers = new Array(50).fill(null);

    // Switch to exam screen
    document.querySelector('.registration-screen').classList.remove('active');
    document.querySelector('.exam-screen').classList.add('active');

    // Show camera box
    document.querySelector('.camera-container').style.display = 'block';

    // Start timer
    startTimer();
    displayQuestion();

    // Start face detection simulation
    startFaceDetectionSimulation();

    // Monitor tab visibility
    document.addEventListener('visibilitychange', handleVisibilityChange);
    document.addEventListener('fullscreenchange', handleFullscreenChange);
    
    // Prevent page reload/close
    window.addEventListener('beforeunload', handleBeforeUnload);
    
    // Record exam start time
    examStartTime = Date.now();
    
    // Schedule fake detections
    scheduleFakeDetections();
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

// ========== EXAM LOGIC ==========
function displayQuestion() {
    const q = currentQuestions[currentQuestionIndex];
    document.getElementById('questionText').textContent = `${currentQuestionIndex + 1}. ${q.q}`;
    document.getElementById('currentQ').textContent = currentQuestionIndex + 1;
    document.getElementById('totalQ').textContent = currentQuestions.length;

    const optionsContainer = document.getElementById('optionsContainer');
    optionsContainer.innerHTML = '';

    q.options.forEach((option, index) => {
        const div = document.createElement('div');
        div.className = 'option';
        if (answers[currentQuestionIndex] === index) {
            div.classList.add('selected');
        }
        div.textContent = option;
        div.onclick = () => selectOption(index);
        optionsContainer.appendChild(div);
    });

    updateProgress();
}

function selectOption(index) {
    answers[currentQuestionIndex] = index;
    
    // Update selected option
    const options = document.querySelectorAll('.option');
    options.forEach(option => option.classList.remove('selected'));
    options[index].classList.add('selected');
    
    // Auto move to next question after 0.5s
    setTimeout(() => {
        if (currentQuestionIndex < currentQuestions.length - 1) {
            currentQuestionIndex++;
            displayQuestion();
        } else {
            submitExam();
        }
    }, 500);
}

function updateProgress() {
    const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
    document.getElementById('progressBar').style.width = progress + '%';
}

// ========== TIMER ==========
function startTimer() {
    timerInterval = setInterval(() => {
        timeRemaining--;
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        document.getElementById('timer').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        if (timeRemaining <= 0) {
            submitExam();
        }
    }, 1000);
}

// ========== FACE DETECTION SIMULATION ==========
function startFaceDetectionSimulation() {
    // Start face detection animation
    faceDetectionInterval = setInterval(() => {
        simulateFaceMovement();
    }, 100);
}

function simulateFaceMovement() {
    const faceOverlay = document.getElementById('faceOverlay');
    
    // Move face position slightly for realistic movement
    facePosition.x += faceDirection.x * (Math.random() * 2 - 1);
    facePosition.y += faceDirection.y * (Math.random() * 2 - 1);
    
    // Keep face within camera bounds
    if (facePosition.x < 20) {
        facePosition.x = 20;
        faceDirection.x = 1;
    } else if (facePosition.x > 100) {
        facePosition.x = 100;
        faceDirection.x = -1;
    }
    
    if (facePosition.y < 20) {
        facePosition.y = 20;
        faceDirection.y = 1;
    } else if (facePosition.y > 80) {
        facePosition.y = 80;
        faceDirection.y = -1;
    }
    
    // Update face overlay position
    faceOverlay.style.display = 'block';
    faceOverlay.style.left = `${facePosition.x}px`;
    faceOverlay.style.top = `${facePosition.y}px`;
    faceOverlay.style.width = `${facePosition.width}px`;
    faceOverlay.style.height = `${facePosition.height}px`;
}

function scheduleFakeDetections() {
    // Schedule first fake detection after 6 seconds
    setTimeout(() => {
        if (!isSubmitting) {
            triggerWarning("AI Detection: Minor face movement detected");
        }
    }, 6000);
    
    // Schedule second fake detection after 10 minutes (600 seconds)
    setTimeout(() => {
        if (!isSubmitting) {
            triggerWarning("AI Detection: Eye movement pattern detected");
        }
    }, 600000);
    
    // Schedule third fake detection near the end (last 5 minutes)
    setTimeout(() => {
        if (!isSubmitting) {
            triggerWarning("AI Detection: Maintaining proper posture");
        }
    }, (EXAM_DURATION - 300) * 1000);
}

function triggerWarning(reason) {
    warningCount++;
    document.getElementById('warningCount').textContent = warningCount;
    document.getElementById('warningIndicator').style.display = 'block';
    
    // Show warning for 5 seconds
    setTimeout(() => {
        document.getElementById('warningIndicator').style.display = 'none';
    }, 5000);
    
    console.log(`Warning ${warningCount}: ${reason}`);
}

// ========== PROCTORING ==========
function handleVisibilityChange() {
    if (document.hidden) {
        console.log("Tab switch detected. Auto-submitting exam...");
        submitExam();
    }
}

function handleFullscreenChange() {
    if (!document.fullscreenElement) {
        console.log("Fullscreen exited. Auto-submitting exam...");
        submitExam();
    }
}

function handleBeforeUnload(e) {
    if (document.querySelector('.exam-screen').classList.contains('active') && !isSubmitting) {
        // Submit exam immediately before page unloads
        console.log("Page unload detected. Auto-submitting exam...");
        submitExamSync();
        
        // Show a message to user
        e.preventDefault();
        e.returnValue = 'Your exam is being submitted. Please wait...';
        return 'Your exam is being submitted. Please wait...';
    }
}

// ========== SUBMISSION ==========
function submitExamSync() {
    // This function submits the exam synchronously without waiting for promises
    isSubmitting = true;
    
    // Calculate score
    let score = 0;
    currentQuestions.forEach((q, i) => {
        if (answers[i] === q.correct) score++;
    });

    console.log('üìä Sync Calculated score:', score);

    // Stop camera and hide camera box
    if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
    }
    
    // Use sendBeacon for reliable submission even during page unload
    const submissionData = {
        action: 'submitExam',
        name: userData.name,
        email: userData.email,
        domain: userData.domain,
        score: score,
        timestamp: new Date().toLocaleString(),
        warnings: warningCount
    };
    
    const blob = new Blob([JSON.stringify(submissionData)], {type: 'application/json'});
    navigator.sendBeacon(GOOGLE_SCRIPT_URL, blob);
    
    // Also try GET as backup (non-blocking)
    const getUrl = `${GOOGLE_SCRIPT_URL}?action=submitExam&email=${encodeURIComponent(userData.email)}&score=${score}&domain=${encodeURIComponent(userData.domain)}`;
    fetch(getUrl).catch(e => console.log('GET backup failed:', e));
    
    // Show success screen immediately (NO SCORE DISPLAYED)
    document.querySelector('.exam-screen').classList.remove('active');
    document.querySelector('.success-screen').classList.add('active');
    
    console.log("Exam submitted synchronously");
}

async function submitExam() {
    if (isSubmitting) return;
    
    isSubmitting = true;
    console.log("Starting exam submission...");
    
    // Calculate score FIRST (before any delays)
    let score = 0;
    currentQuestions.forEach((q, i) => {
        if (answers[i] === q.correct) score++;
    });

    console.log('üìä Calculated score:', score, 'out of', currentQuestions.length);

    // IMMEDIATELY show success screen (no loading delay)
    document.querySelector('.exam-screen').classList.remove('active');
    document.querySelector('.success-screen').classList.add('active');

    // Then clean up resources (non-blocking)
    cleanupExamResources();

    // Submit score in background (non-blocking)
    submitScoreInBackground(score);
}

function cleanupExamResources() {
    // Clear all intervals
    clearInterval(timerInterval);
    if (faceDetectionInterval) clearInterval(faceDetectionInterval);
    
    // Remove event listeners
    document.removeEventListener('visibilitychange', handleVisibilityChange);
    document.removeEventListener('fullscreenchange', handleFullscreenChange);
    window.removeEventListener('beforeunload', handleBeforeUnload);

    // Stop camera
    if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
    }
    document.querySelector('.camera-container').style.display = 'none';

    // Exit fullscreen
    if (document.fullscreenElement) {
        document.exitFullscreen().catch(() => {});
    }
}

function submitScoreInBackground(score) {
    // Submit using sendBeacon (fastest method - doesn't wait for response)
    const submissionData = {
        action: 'submitExam',
        name: userData.name,
        email: userData.email,
        domain: userData.domain,
        score: score,
        timestamp: new Date().toLocaleString(),
        warnings: warningCount
    };
    
    const blob = new Blob([JSON.stringify(submissionData)], {type: 'application/json'});
    const beaconSent = navigator.sendBeacon(GOOGLE_SCRIPT_URL, blob);
    console.log('üì§ Beacon submission:', beaconSent ? '‚úÖ Success' : '‚ùå Failed');

    // Also try GET as backup (non-blocking)
    setTimeout(() => {
        const getUrl = `${GOOGLE_SCRIPT_URL}?action=submitExam&email=${encodeURIComponent(userData.email)}&score=${score}&domain=${encodeURIComponent(userData.domain)}&name=${encodeURIComponent(userData.name)}`;
        fetch(getUrl)
            .then(response => response.json())
            .then(result => console.log('‚úÖ GET backup submission:', result.success))
            .catch(error => console.log('‚ùå GET backup failed:', error));
    }, 100);
    
    console.log("üéØ Exam completed instantly - score submitted in background");
}

// ========== INITIALIZATION ==========
console.log("üéØ Online Exam System Loaded");
console.log("üåê Backend URL:", GOOGLE_SCRIPT_URL);

// Check device compatibility on page load
window.addEventListener('load', function() {
    console.log("üîß Checking device compatibility...");
    
    if (!checkDeviceCompatibility()) {
        console.log("‚ùå Mobile device detected - access blocked");
        return;
    }
    
    console.log("‚úÖ Desktop device detected - access granted");
    
    // Test backend connection
    fetch(GOOGLE_SCRIPT_URL)
        .then(response => response.json())
        .then(data => {
            console.log("‚úÖ Backend connection successful:", data);
        })
        .catch(error => {
            console.error("‚ùå Backend connection failed:", error);
        });
});

// Also check on window resize
window.addEventListener('resize', function() {
    if (isMobileDevice() && document.querySelector('.registration-screen.active')) {
        alert('Please use a desktop computer to take this exam. Mobile devices are not supported.');
    }
});
</script>